# file: ansible-role-rtags/tasks/install.yml

- name: RTAGS | get from git repository
  become: true
  git: repo="{{ rtags_repo_url }}"
       dest="{{ rtags_tmp }}"
       version="{{ rtags_version }}"
  register: rtags_downloaded

- name: RTAGS | Create build directory
  become: true
  file:
    path: "{{ rtags_build_dir }}"
    state: directory

- name: RTAGS | run cmake
  become: true
  command: chdir="{{ rtags_build_dir }}" cmake -DCMAKE_EXPORT_COMPILE_COMMANDS=1 \
           -DCMAKE_C_COMPILER=clang \
           -DCMAKE_CXX_COMPILER=clang++ \
           -DCMAKE_INSTALL_PREFIX={{rtags_install_dir}} \
           -DGCC_INSTALL_PREFIX={{gcc_install_dir}} \
           -DLIBCLANG_LLVM_CONFIG_EXECUTABLE={{llvm_config}} {{ rtags_tmp }}
  # when: rtags_downloaded.changed

- name: RTAGS | make
  become: true
  command: chdir="{{ rtags_build_dir }}" make
  # when: rtags_downloaded.changed

- name: RTAGS | make install
  become: true
  command: chdir="{{ rtags_build_dir }}" make install
  # when: rtags_downloaded.changed
